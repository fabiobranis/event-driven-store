FROM node:18-alpine

WORKDIR /usr/src/app

COPY package*.json ./

COPY ./shared ./shared

COPY ./server ./server

RUN npm ci

ENV SERVER_PORT=$SERVER_PORT
ENV PG_CONN_STR=$PG_CONN_STR
ENV SMTP_HOST=$SMTP_HOST
ENV SMTP_PORT=$SMTP_PORT
ENV MAIL_ADDRESS=$MAIL_ADDRESS
ENV REDIS_CONNECTION_STRING=$REDIS_CONNECTION_STRING
ENV QUEUE_NAME=$QUEUE_NAME
EXPOSE $SERVER_PORT

CMD ["npm", "run", "start:server"] 